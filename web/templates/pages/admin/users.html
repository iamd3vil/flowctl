{{ define "pages/admin/users.html" }} {{ template "layouts/base.html" . }} {{
end }} {{ define "content" }}
<div
    class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"
    x-data="adminUsersPage()"
>
    <div class="py-10">
        <h1 class="text-2xl font-semibold text-foreground">Users Management</h1>
    </div>

    <!-- Search and Add User Section -->
    <div class="flex justify-between items-center mb-6">
        <input
            type="text"
            x-model="searchQuery"
            @input.debounce.500ms="search()"
            placeholder="Search users..."
            class="block w-full max-w-lg rounded-md border-input bg-background shadow-sm focus:border-ring focus:ring-ring sm:text-sm px-4 py-2"
        />
        <button
            @click="addUser()"
            class="ml-4 inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-primary-foreground bg-primary hover:bg-primary/90"
        >
            Add User
        </button>
    </div>

    <!-- Users Table -->
    <div
        class="mt-8 overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg"
    >
        <table class="min-w-full divide-y divide-gray-300">
            <thead class="bg-secondary">
                <tr>
                    <th
                        class="py-3.5 pl-6 pr-3 text-left text-sm font-semibold"
                    >
                        Name
                    </th>
                    <th class="px-3 py-3.5 text-left text-sm font-semibold">
                        Username
                    </th>
                    <th class="px-3 py-3.5 text-left text-sm font-semibold">
                        Groups
                    </th>
                    <th class="relative py-3.5 pl-3 pr-6">
                        <span class="sr-only">Actions</span>
                    </th>
                </tr>
            </thead>
            <tbody
                class="divide-y divide-gray-200 bg-white"
                id="users-table-body"
            >
                {{ template "partials/users_table_rows.html" .Users }}
            </tbody>
        </table>
    </div>

    <!-- Modal Container -->
    <div id="modal-container"></div>
</div>

<script>
    function adminUsersPage() {
        return {
            searchQuery: "",
            async search() {
                try {
                    const response = await fetch(
                        `/api/v1/admin/users/search?q=${this.searchQuery}`,
                    );
                    if (!response.ok) throw new Error("Search failed");
                    const html = await response.text();
                    document.getElementById("users-table-body").innerHTML =
                        html;
                } catch (error) {
                    window.dispatchEvent(
                        new CustomEvent("notify", {
                            detail: { message: error.message, type: "error" },
                        }),
                    );
                }
            },
            addUser() {
                // In a real app, you'd fetch a modal template from the server
                // For now, we'll just log it.
                console.log("Open add user modal");
                window.dispatchEvent(
                    new CustomEvent("notify", {
                        detail: {
                            message: "Add user modal not implemented yet.",
                            type: "info",
                        },
                    }),
                );
            },
            editUser(id) {
                console.log(`Open edit user modal for ${id}`);
            },
            deleteUser(id) {
                if (confirm("Are you sure you want to delete this user?")) {
                    console.log(`Deleting user ${id}`);
                    // fetch(`/api/v1/admin/users/${id}`, { method: 'DELETE' })...
                }
            },
        };
    }
</script>
{{ end }}
